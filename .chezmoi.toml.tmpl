{{- $name := "Meeko" -}}
{{- $email := "your@email.com" -}}
{{- $username := .chezmoi.username -}}

{{- if eq .chezmoi.os "windows" -}}
{{-   $username = or (env "USERNAME") .chezmoi.username -}}
{{- end -}}

# Main chezmoi configuration file
# Documentation: https://www.chezmoi.io/reference/configuration-file/

# Source directory configuration (platform-specific)
{{- if eq .chezmoi.os "windows" }}
sourceDir = "{{ .chezmoi.homeDir }}\\.dotfiles"
{{- else if eq .chezmoi.os "darwin" }}
sourceDir = "{{ .chezmoi.homeDir }}/.local/share/chezmoi"
{{- else if eq .chezmoi.os "linux" }}
sourceDir = "{{ .chezmoi.homeDir }}/.local/share/chezmoi"
{{- end }}

# File permissions
umask = 0o022

# Template settings
[template]
  options = ["missingkey=error"]

# Template data available in all templates
[data]
  name = {{ $name | quote }}
  email = {{ $email | quote }}
  username = {{ $username | quote }}

# Git repository settings
[git]
  autoCommit = false
  autoPush = false

# Diff settings
[diff]
  exclude = ["scripts"]
  pager = "less -R"

# Merge settings
[merge]
  command = "code"
  args = ["--wait", "--merge", "{{ "{{ .Destination }}" }}", "{{ "{{ .Source }}" }}", "{{ "{{ .Target }}" }}"]

# Edit settings
[edit]
  command = "code"
  args = ["--wait"]

# CD settings (shell integration)
{{- if eq .chezmoi.os "windows" }}
[cd]
  command = "powershell"
{{- else }}
[cd]
  command = "bash"
{{- end }}

# Encryption settings (age)
[age]
  # Uncomment and configure if using age encryption
  # identity = "~/.config/chezmoi/key.txt"
  # recipient = "age1..."

# Minimum age for auto-update check
[update]
  command = "git"
  args = ["pull", "--rebase"]

# Auto-update settings
[autoUpdate]
  enable = false
  interval = "168h" # 7 days

# Interactive prompts
[promptBool]
  prompt = true

# Script execution settings
[scriptEnv]
  # Environment variables available to scripts
  DOTFILES_DIR = {{ .chezmoi.sourceDir | quote }}

{{- if eq .chezmoi.os "windows" }}
  POWERSHELL_TELEMETRY_OPTOUT = "1"
{{- end }}

# Warning on remove
[remove]
  prompt = true

# Platform-specific settings
{{- if eq .chezmoi.os "windows" }}

[interpreters.ps1]
  command = "powershell"
  args = ["-NoLogo", "-NoProfile", "-ExecutionPolicy", "Bypass", "-Command"]

{{- else if eq .chezmoi.os "darwin" }}

[interpreters.sh]
  command = "/bin/bash"

{{- else if eq .chezmoi.os "linux" }}

[interpreters.sh]
  command = "/bin/bash"

{{- end }}
